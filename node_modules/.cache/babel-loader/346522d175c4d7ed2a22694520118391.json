{"ast":null,"code":"import axios from \"axios\";\nimport jwtDecode from \"jwt-decode\";\nimport { authActions } from \"../redux/slices/authSlice\";\nconst instance = axios.create({\n  baseURL: \"http://localhost:8080/api\",\n  withCredentials: true\n});\nexport const apiCallerWithToken = (token, dispatch) => {\n  const a = axios.create({\n    baseURL: \"http://localhost:8080/api\",\n    withCredentials: true\n  });\n  a.interceptors.request.use(async config => {\n    try {\n      console.log(\"token: \", token);\n\n      if (token) {\n        const ngu = jwtDecode(token);\n\n        if (ngu.exp * 1000 < new Date().getTime()) {\n          console.log(\"Truoc refresh\");\n          const res = await axios.post(\"auth/refresh-token\", {}, {\n            baseURL: \"http://localhost:8080/api\",\n            withCredentials: true\n          });\n          console.log(\"sau refresh\");\n          const {\n            code,\n            message,\n            data\n          } = res.data;\n          console.log(data.accessToken);\n\n          if (code === 200 || message === \"Success\") {\n            const {\n              accessToken\n            } = data;\n            console.log(\"new token: \", accessToken);\n            config.headers[\"authorization\"] = `Bearer ${accessToken}`;\n            dispatch(authActions.refreshToken(accessToken));\n          }\n        } else {\n          config.headers[\"authorization\"] = `Bearer ${token}`;\n        }\n      } // dispatch(authActions.logout());\n\n    } catch (error) {\n      console.log(error.message.response.data.code); // error.message.response.data.code === 401 && dispatch(authActions.logout());\n    }\n\n    return config;\n  });\n  return a;\n};\nexport default instance;","map":{"version":3,"names":["axios","jwtDecode","authActions","instance","create","baseURL","withCredentials","apiCallerWithToken","token","dispatch","a","interceptors","request","use","config","console","log","ngu","exp","Date","getTime","res","post","code","message","data","accessToken","headers","refreshToken","error","response"],"sources":["D:/Hoc tap/ReactJS/Maltimart-ecommerce/src/config/configAxios.js"],"sourcesContent":["import axios from \"axios\";\r\nimport jwtDecode from \"jwt-decode\";\r\nimport { authActions } from \"../redux/slices/authSlice\";\r\n\r\nconst instance = axios.create({\r\n  baseURL: \"http://localhost:8080/api\",\r\n  withCredentials: true,\r\n});\r\n\r\nexport const apiCallerWithToken = (token, dispatch) => {\r\n  const a = axios.create({\r\n    baseURL: \"http://localhost:8080/api\",\r\n    withCredentials: true,\r\n  });\r\n  a.interceptors.request.use(async (config) => {\r\n    try {\r\n      console.log(\"token: \", token);\r\n      if (token) {\r\n        const ngu = jwtDecode(token);\r\n\r\n        if (ngu.exp * 1000 < new Date().getTime()) {\r\n          console.log(\"Truoc refresh\");\r\n          const res = await axios.post(\r\n            \"auth/refresh-token\",\r\n            {},\r\n            {\r\n              baseURL: \"http://localhost:8080/api\",\r\n              withCredentials: true,\r\n            }\r\n          );\r\n          console.log(\"sau refresh\");\r\n          const { code, message, data } = res.data;\r\n          console.log(data.accessToken);\r\n          if (code === 200 || message === \"Success\") {\r\n            const { accessToken } = data;\r\n            console.log(\"new token: \", accessToken);\r\n            config.headers[\"authorization\"] = `Bearer ${accessToken}`;\r\n            dispatch(authActions.refreshToken(accessToken));\r\n          }\r\n        } else {\r\n          config.headers[\"authorization\"] = `Bearer ${token}`;\r\n        }\r\n      }\r\n\r\n      // dispatch(authActions.logout());\r\n    } catch (error) {\r\n      console.log(error.message.response.data.code);\r\n      // error.message.response.data.code === 401 && dispatch(authActions.logout());\r\n    }\r\n    return config;\r\n  });\r\n\r\n  return a;\r\n};\r\n\r\nexport default instance;\r\n"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,WAAT,QAA4B,2BAA5B;AAEA,MAAMC,QAAQ,GAAGH,KAAK,CAACI,MAAN,CAAa;EAC5BC,OAAO,EAAE,2BADmB;EAE5BC,eAAe,EAAE;AAFW,CAAb,CAAjB;AAKA,OAAO,MAAMC,kBAAkB,GAAG,CAACC,KAAD,EAAQC,QAAR,KAAqB;EACrD,MAAMC,CAAC,GAAGV,KAAK,CAACI,MAAN,CAAa;IACrBC,OAAO,EAAE,2BADY;IAErBC,eAAe,EAAE;EAFI,CAAb,CAAV;EAIAI,CAAC,CAACC,YAAF,CAAeC,OAAf,CAAuBC,GAAvB,CAA2B,MAAOC,MAAP,IAAkB;IAC3C,IAAI;MACFC,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBR,KAAvB;;MACA,IAAIA,KAAJ,EAAW;QACT,MAAMS,GAAG,GAAGhB,SAAS,CAACO,KAAD,CAArB;;QAEA,IAAIS,GAAG,CAACC,GAAJ,GAAU,IAAV,GAAiB,IAAIC,IAAJ,GAAWC,OAAX,EAArB,EAA2C;UACzCL,OAAO,CAACC,GAAR,CAAY,eAAZ;UACA,MAAMK,GAAG,GAAG,MAAMrB,KAAK,CAACsB,IAAN,CAChB,oBADgB,EAEhB,EAFgB,EAGhB;YACEjB,OAAO,EAAE,2BADX;YAEEC,eAAe,EAAE;UAFnB,CAHgB,CAAlB;UAQAS,OAAO,CAACC,GAAR,CAAY,aAAZ;UACA,MAAM;YAAEO,IAAF;YAAQC,OAAR;YAAiBC;UAAjB,IAA0BJ,GAAG,CAACI,IAApC;UACAV,OAAO,CAACC,GAAR,CAAYS,IAAI,CAACC,WAAjB;;UACA,IAAIH,IAAI,KAAK,GAAT,IAAgBC,OAAO,KAAK,SAAhC,EAA2C;YACzC,MAAM;cAAEE;YAAF,IAAkBD,IAAxB;YACAV,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BU,WAA3B;YACAZ,MAAM,CAACa,OAAP,CAAe,eAAf,IAAmC,UAASD,WAAY,EAAxD;YACAjB,QAAQ,CAACP,WAAW,CAAC0B,YAAZ,CAAyBF,WAAzB,CAAD,CAAR;UACD;QACF,CAnBD,MAmBO;UACLZ,MAAM,CAACa,OAAP,CAAe,eAAf,IAAmC,UAASnB,KAAM,EAAlD;QACD;MACF,CA3BC,CA6BF;;IACD,CA9BD,CA8BE,OAAOqB,KAAP,EAAc;MACdd,OAAO,CAACC,GAAR,CAAYa,KAAK,CAACL,OAAN,CAAcM,QAAd,CAAuBL,IAAvB,CAA4BF,IAAxC,EADc,CAEd;IACD;;IACD,OAAOT,MAAP;EACD,CApCD;EAsCA,OAAOJ,CAAP;AACD,CA5CM;AA8CP,eAAeP,QAAf"},"metadata":{},"sourceType":"module"}